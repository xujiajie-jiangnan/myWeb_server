## 性能瓶颈以及测试调试中所遇到的问题

* Q1: 在用Webbench进行压力测试的初尝试的时候，仅并发1k的连接，就会有很多请求failed，定位Bug然后查阅博客后
      定位到epoll_wait阻塞住了，并且lsof发现主线程打开的文件描述符大多小于1000;并且tcpdump抓包发现，压测
      的时候，accept连接队列很快溢出;

  A1: 有两个考虑的点：一个是listen()的backlog可能设置的太小; 第二个就是我的listenfd是ET模式，当大量连接来
      时，只会触发一次listenfd可读事件，而我居然仅accept一次，修改bug,将其改为循环即可;
      while(accept_fd=accept()) 循环读到空为止

* Q2: 上述问题解决后，有所改善，但是仍会fail;
  
  A2: ulimit -a 发现进程可打开文件描述符的数量设置为65535,没有问题，但是lsof 的文件描述符大多小于1000,这很不符合
      并发1k的时候的该有的文件描述符大小，之后定位发现，fd2req数组的MAXFD我设置的过小，并且代码中超过限制就close掉
      ，这就导致了很多连接丢失还没干活就关闭了;

* Q3: 我构架的服务器瓶颈还是蛮明显的，并发数量仅在10k以内，speed打开的页面数量每分钟也就只有50万左右;
  A3: 我暂时还没实践解决，但是可能有一下4个方面可以优化，要不然就是框架问题，这个没办法重写哈哈哈;
      (1) 硬件问题，测试虚拟机CPU核数线程数变化的影响;
      (2) 可能还是HTTP解析的时候过程还是过慢，这需要代码优化了;
      (3) 使用的string类的buffer
      (4) 博客和linya学长说，http解析的时候头部用map会优于unordered_map